<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>

    <title>Adlerweg</title>

    <link rel="stylesheet" href="js/leaflet/leaflet.css"/>
    <script src="js/leaflet/leaflet.js"></script>
    <script src="js/leaflet-hash/leaflet-hash.js"></script>
    <script src="data/AdlerwegEtappeO5.js"></script>

    <!--Leaflet elevation https://github.com/MrMufflon/Leaflet.Elevation-->
    <link rel="stylesheet" href="js/leaflet-elevation/leaflet.elevation-0.0.4.css"/>
    <script src="js/leaflet-elevation/leaflet.elevation-0.0.4.min.js"></script>
    <script src="js/leaflet-elevation/leaflet.elevation-0.0.4.src.js"></script>
    <script src="js/d3v3/d3.v3.min.js" charset="utf-8"></script>
    <script src='js/leaflet-omnivore/leaflet-omnivore.min.js'></script>

    <style>
        body {
            padding: 0px;
            margin: 0px;
        }

        html, body{
        }
        #map {
            height: 600px;
            width: 1024px;
            margin: auto; // center map
        }
        h1{
            font-family: "Book Antiqua", "serif";
            font-size: 20px;
            text-align: center;
        }
        p{
            text-align: center;
            font-family: "Book Antiqua", "serif";
            font-size: small;
        }
        #stages{

        }
    </style>
</head>

<body>
<h1>Adlerweg-Etappe O5: Badener Hütte  –  Matreier Tauernhaus</h1>
<p>Ein wunderbares Gletscherpanorama wartet entlang dieser Adlerweg-Etappe in Osttirol. </br>Über den Venediger Höhenweg führt die Route nach Osten zum Venedigerhaus von Innergschlöss und schließlich weiter bis zum Etappenziel, dem Matreier Tauernhaus.</p>
<div id="map"></div>
<p><select id="stages">
    <option value="AdlerwegEtappe01.gpx">Adlerweg Etappe 1 </option> // write at several points at the same time: Alt + J
    <option value="AdlerwegEtappe02.gpx">Adlerweg Etappe 2 </option>
    <option value="AdlerwegEtappe03.gpx">Adlerweg Etappe 3 </option>
    <option value="AdlerwegEtappe04.gpx">Adlerweg Etappe 4 </option>
    <option value="AdlerwegEtappe05.gpx">Adlerweg Etappe 5 </option>
    <option value="AdlerwegEtappe06.gpx">Adlerweg Etappe 6 </option>
    <option value="AdlerwegEtappe07.gpx">Adlerweg Etappe 7 </option>
    <option value="AdlerwegEtappe08.gpx">Adlerweg Etappe 8 </option>
    <option value="AdlerwegEtappe09.gpx">Adlerweg Etappe 9 </option>
    <option value="AdlerwegEtappe10.gpx">Adlerweg Etappe 10</option>
    <option value="AdlerwegEtappe11.gpx">Adlerweg Etappe 11</option>
    <option value="AdlerwegEtappe12.gpx">Adlerweg Etappe 12</option>
    <option value="AdlerwegEtappe13.gpx">Adlerweg Etappe 13</option>
    <option value="AdlerwegEtappe14.gpx">Adlerweg Etappe 14</option>
    <option value="AdlerwegEtappe15.gpx">Adlerweg Etappe 15</option>
    <option value="AdlerwegEtappe16.gpx">Adlerweg Etappe 16</option>
    <option value="AdlerwegEtappe17.gpx">Adlerweg Etappe 17</option>
    <option value="AdlerwegEtappe18.gpx">Adlerweg Etappe 18</option>
    <option value="AdlerwegEtappe19.gpx">Adlerweg Etappe 19</option>
    <option value="AdlerwegEtappe20.gpx">Adlerweg Etappe 20</option>
    <option value="AdlerwegEtappe21.gpx">Adlerweg Etappe 21</option>
    <option value="AdlerwegEtappe22.gpx">Adlerweg Etappe 22</option>
    <option value="AdlerwegEtappe23.gpx">Adlerweg Etappe 23</option>
    <option value="AdlerwegEtappe24.gpx">Adlerweg Etappe 24</option>
    <option value="AdlerwegEtappe25.gpx">Adlerweg Etappe 25</option>
    <option value="AdlerwegEtappeO1.gpx">Adlerweg Etappe Osttirol 1 </option>
    <option value="AdlerwegEtappeO2.gpx">Adlerweg Etappe Osttirol 2 </option>
    <option value="AdlerwegEtappeO3.gpx">Adlerweg Etappe Osttirol 3 </option>
    <option value="AdlerwegEtappeO4.gpx">Adlerweg Etappe Osttirol 4 </option>
    <option value="AdlerwegEtappeO5.gpx">Adlerweg Etappe Osttirol 5 </option>
    <option value="AdlerwegEtappeO6.gpx">Adlerweg Etappe Osttirol 6 </option>
    <option value="AdlerwegEtappeO7.gpx">Adlerweg Etappe Osttirol 7 </option>
    <option value="AdlerwegEtappeO8.gpx">Adlerweg Etappe Osttirol 8 </option>
    <option value="AdlerwegEtappeO9.gpx">Adlerweg Etappe Osttirol 9 </option>
</select></p>

<p><a href="https://github.com/Sophia10">Sophia Paul</a></p>

<script>
    // WMTS-Layer basemap.at - Quelle: http://www.basemap.at/wmts/1.0.0/WMTSCapabilities.xml
    var layers = {
        geolandbasemap: L.tileLayer("https://{s}.wien.gv.at/basemap/geolandbasemap/normal/google3857/{z}/{y}/{x}.png", {
            subdomains: ['maps', 'maps1', 'maps2', 'maps3', 'maps4'],
            attribution: 'Datenquelle: <a href="http://www.basemap.at/">basemap.at</a>'
        }),
        bmapgrau: L.tileLayer("https://{s}.wien.gv.at/basemap/bmapgrau/normal/google3857/{z}/{y}/{x}.png", {
            subdomains: ['maps', 'maps1', 'maps2', 'maps3', 'maps4'],
            attribution: 'Datenquelle: <a href="http://www.basemap.at/">basemap.at</a>'
        }),
        bmapoverlay: L.tileLayer("https://{s}.wien.gv.at/basemap/bmapoverlay/normal/google3857/{z}/{y}/{x}.png", {
            subdomains: ['maps', 'maps1', 'maps2', 'maps3', 'maps4'],
            attribution: 'Datenquelle: <a href="http://www.basemap.at/">basemap.at</a>'
        }),
        bmaphidpi: L.tileLayer("https://{s}.wien.gv.at/basemap/bmaphidpi/normal/google3857/{z}/{y}/{x}.jpeg", {
            subdomains: ['maps', 'maps1', 'maps2', 'maps3', 'maps4'],
            attribution: 'Datenquelle: <a href="http://www.basemap.at/">basemap.at</a>'
        }),
        bmaporthofoto30cm: L.tileLayer("https://{s}.wien.gv.at/basemap/bmaporthofoto30cm/normal/google3857/{z}/{y}/{x}.jpeg", {
            subdomains: ['maps', 'maps1', 'maps2', 'maps3', 'maps4'],
            attribution: 'Datenquelle: <a href="http://www.basemap.at/">basemap.at</a>'
        }),
        osm: L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            subdomains: ['a', 'b', 'c'],
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        })
    };

    // Karte definieren
    var map = L.map('map', {
        layers: [layers.geolandbasemap],
        center: [47.0997, 12.4638],
        zoom: 11
    });

    // Maßstab hinzufügen
    L.control.scale({
        maxWidth: 200,
        metric: true,
        imperial: false
    }).addTo(map);

    // add height profile with Leaflet Elevation
    var el = L.control.elevation({
        position: "bottomright",
        theme: "steelblue-theme", //default: lime-theme
        width: 600,
        height: 210,
        margins: {
            top: 10,
            right: 20,
            bottom: 30,
            left: 50
        },
        useHeightIndicator: true, //if false a marker is drawn at map position
        interpolation: "linear", //see https://github.com/mbostock/d3/wiki/SVG-Shapes#wiki-area_interpolate
        hoverNumber: {
            decimalsX: 3, //decimals on distance (always in km)
            decimalsY: 0, //deciamls on hehttps://www.npmjs.com/package/leaflet.coordinatesight (always in m)
            formatter: undefined //custom formatter function may be injected
        },
        xTicks: undefined, //number of ticks in x axis, calculated by default according to width
        yTicks: undefined, //number of ticks on y axis, calculated by default according to height
        collapsed: false,  //collapsed mode, show chart on click or mouseover
        imperial: false    //display imperial units instead of metric
    });
    el.addTo(map);

    // WMTS-Layer Auswahl hinzufügen
    var layerControl = L.control.layers({
        "basemap.at - STANDARD": layers.geolandbasemap,
        "basemap.at - GRAU": layers.bmapgrau,
        "basemap.at - OVERLAY": layers.bmapoverlay,
        "basemap.at - HIGH-DPI": layers.bmaphidpi,
        "basemap.at - ORTHOFOTO": layers.bmaporthofoto30cm,
        "OpenStreetMap": layers.osm
    }).addTo(map);

    // leaflet-hash aktivieren
    var hash = new L.Hash(map);

    //add icons
    var hutIcon = L.icon({
        iconUrl: 'icons/hut.png',
        iconAnchor: [16, 37]
    });
    var start = L.icon({
        iconUrl: 'icons/start.png',
        iconAnchor: [16, 37]
    });
    var finish = L.icon({
        iconUrl: 'icons/finish.png',
        iconAnchor: [16, 37]
    });

    var markers = [
        L.marker([47.08111, 12.42563], {title: "Badener Hütte", icon: hutIcon}),
        L.marker([47.12388, 12.45134], {title: "Venedigerhaus", icon: hutIcon}),
        L.marker([47.1190453, 12.4965305], {title: "Matreier Tauernhaus", icon: hutIcon})
    ];

    var startFinish = [
        L.marker([47.081220061570853, 12.425527399026949], {title: "Start", icon: start}),
        L.marker([47.11900448608926, 12.496790516942312], {title: "Ziel", icon: finish})
    ];

    // feature group to add to map
    var hutsLayer = L.featureGroup();
    for (var i = 0; i < markers.length; i++) {
        hutsLayer.addLayer(markers[i]);
    }
    //hutsLayer.addTo(map); -> only at certain zoom level, see below
    var startFinishLayer = L.featureGroup();
    for (var j = 0; j < startFinish.length; j++) {
        startFinishLayer.addLayer(startFinish[j]);
    }
    startFinishLayer.addTo(map);

    //show huts only at certain zoom level
    map.on("zoomend", function () { // zoom end xD
            if (map.getZoom() >= 13) {
                map.addLayer(hutsLayer);
            }
            else {
                map.removeLayer(hutsLayer);
            }
        }
    );

    /*
     // add geoJSON
     L.geoJSON(window.etappeO5, {
     onEachFeature: el.addData.bind(el) //Leaflet Elevation
     }).addTo(map);*/
    function loadTrack(currentTrack) {
        // GPX track import with Leaflet Omnivore
        var track = omnivore.gpx('data/'+currentTrack).addTo(map);
        //Little Comment
        // add popup, bounds and height profile
        track.on('ready', function () {
            // Popup hinzufügen
            var markup = '<h3>Adlerweg-Etappe 1: St. Johann – Gaudeamushütte</h3>';
            markup += '<p>Ein wunderbares Gletscherpanorama wartet entlang dieser Adlerweg-Etappe in Osttirol. Über den Venediger Höhenweg führt die Route nach Osten zum Venedigerhaus von Innergschlöss und schließlich weiter bis zum Etappenziel, dem Matreier Tauernhaus.</p>';
            markup += '<li>Ausgangspunkt: Badener Hütte </li>';
            markup += '<li>Endpunkt: Matreier Tauernhaus</li>';
            markup += '<li>Höhenmeter bergauf: 450</li>';
            markup += '<li>Höhenmeter bergab: 1550</li>';
            markup += '<li>Höchster Punkt: 2768</li>';
            markup += '<li>Schwierigkeitsgrad: schwarz</li>';
            markup += '<li>Streckenlänge (in km): 14</li>';
            markup += '<li>Gehzeit (in Stunden): 5,5</li>';
            markup += '<li>Einkehrmöglichkeiten: Venedigerhaus, Matreier Tauernhaus</li>';
            markup += '<li><a href="http://www.tirol.at/reisefuehrer/sport/wandern/wandertouren/a-adlerweg-etappe-o5-badener-huette-matreier-tauernhaus">Weitere Informationen</a></li>';
            track.bindPopup(markup, {maxWidth: 450});

            // set bounds
            map.fitBounds(track.getBounds());

            // generate height profile
            el.clear();
            track.eachLayer(function (layer) {
                el.addData(layer.feature);
                // get points from feature to further use them
                var pts = layer.feature.geometry.coordinates;
                //console.log(pts);
                // read coordinate pairs from points-layer (start with second point/first pair)
                for (var i = 1; i < pts.length; i++) {
                    //console.log(pts[i]); // current point
                    //console.log(pts[i-1]); // previous point
                    // calculate distance
                    var dist = map.distance(
                        [pts[i][1], pts[i][0]], // lat and lng values per point
                        [pts[i - 1][1], pts[i - 1][0]]
                    ).toFixed(2); //round to zero decimal points
                    // calculate height difference
                    var delta = (pts[i][2] - pts[i - 1][2]).toFixed(2);

                    // calculate slope
                    var slopeRad = Math.atan(delta / dist);
                    var slope = (slopeRad * (180 / Math.PI)).toFixed(2); //in degrees
                    //console.log(delta, " Höhenmeter auf ", dist, "m Distanz, also", slope, "Grad Steigung.");

                    // color definitions
                    //rot: ['#ffffb2','#fed976','#feb24c','#fd8d3c','#f03b20','#bd0026'] //from colorbrewer.org
                    //grün: ['#edf8e9','#c7e9c0','#a1d99b','#74c476','#31a354','#006d2c']

                    // add switch-statement to change colors according to the steepness of the terrain
                    var color;
                    
                    switch (true) { // checks if condition is true, not for certain values of a variable
                        case (slope >= 20):
                            color = "#bd0026";
                            break;
                        case (slope >= 15):
                            color = "#f03b20";
                            break;
                        case (slope >= 10):
                            color = "#fd8d3c";
                            break;
                        case (slope >= 5):
                            color = "#feb24c";
                            break;
                        case (slope >= 1):
                            color = "#fed976";
                            break;
                        case (slope >= -1):
                            color = "#ffffff";
                            break; // white instead of "yellow"
                        case (slope >= -5):
                            color = "#d9f0a3";
                            break;
                        case (slope >= -10):
                            color = "#addd8e";
                            break;
                        case (slope >= -15):
                            color = "#78c679";
                            break;
                        case (slope >= -20):
                            color = "#31a354";
                            break;
                        case (slope < -20):
                            color = "#006837";
                            break;
                    }
                    //console.log(slope + " " + color);

                    // add new polyline with slope colors
                    var pointA = new L.LatLng(pts[i][1], pts[i][0]);
                    var pointB = new L.LatLng(pts[i - 1][1], pts[i - 1][0]);
                    var pointList = [pointA, pointB];

                    var polyline = new L.Polyline(pointList, {
                        color: color,
                        weight: 6,
                        opacity: 1,
                        smoothFactor: 1
                    });
                    polyline.addTo(map);
                }
            });
        });
    }
// change stages
    var stageSelector = document.getElementById("stages");
    stageSelector.onchange = function(evt){
        console.log("Change event: ", evt);
        var selectedTrack = stageSelector[stageSelector.selectedIndex].value;
        console.log("GPX Track laden: ", stageSelector[stageSelector.selectedIndex].value);
        loadTrack(stageSelector[stageSelector.selectedIndex].value);
    };
    loadTrack('AdlerwegEtappe01.gpx');


</script>

</body>

</html>
